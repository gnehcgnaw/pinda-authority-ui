{"remainingRequest":"D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\src\\views\\pinda\\file\\attachment\\Index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\src\\views\\pinda\\file\\attachment\\Index.vue","mtime":1585207882903},{"path":"D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\品达通用权限系统\\资料\\前端工程\\pinda-authority-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:\\\\\\u54C1\\u8FBE\\u901A\\u7528\\u6743\\u9650\\u7CFB\\u7EDF\\\\\\u8D44\\u6599\\\\\\u524D\\u7AEF\\u5DE5\\u7A0B\\\\pinda-authority-ui\\\\node_modules\\\\@babel\\\\runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.array.sort\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:\\\\\\u54C1\\u8FBE\\u901A\\u7528\\u6743\\u9650\\u7CFB\\u7EDF\\\\\\u8D44\\u6599\\\\\\u524D\\u7AEF\\u5DE5\\u7A0B\\\\pinda-authority-ui\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/objectSpread2\"));\n\nrequire(\"core-js/modules/es6.regexp.search\");\n\nvar _Pagination = _interopRequireDefault(require(\"@/components/Pagination\"));\n\nvar _Edit = _interopRequireDefault(require(\"./Edit\"));\n\nvar _Attachment = _interopRequireDefault(require(\"@/api/Attachment.js\"));\n\nvar _utils = require(\"@/utils/utils\");\n\nvar _settings = require(\"@/settings\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'AttachmentManage',\n  components: {\n    Pagination: _Pagination.default,\n    AttachmentEdit: _Edit.default\n  },\n  filters: {},\n  data: function data() {\n    return {\n      dialogVisible: false,\n      dialogImageUrl: '',\n      dialog: {\n        isVisible: false,\n        type: 'add'\n      },\n      tableKey: 0,\n      queryParams: {},\n      sort: {},\n      selection: [],\n      // 以下已修改\n      loading: false,\n      tableData: {\n        records: [],\n        total: 0\n      },\n      pagination: {\n        size: 10,\n        current: 1\n      }\n    };\n  },\n  computed: {},\n  mounted: function mounted() {\n    this.fetch();\n  },\n  methods: {\n    errorImage: function errorImage() {\n      var img = event.srcElement;\n      img.src = require('@/assets/404_images/404_image.jpeg');\n      img.onerror = null; //防止闪图\n    },\n    formatSize: function formatSize(row) {\n      return (0, _utils.renderSize)(row.size);\n    },\n    filterStatus: function filterStatus(value, row) {\n      return row.status === value;\n    },\n    editClose: function editClose() {\n      this.dialog.isVisible = false;\n    },\n    editSuccess: function editSuccess() {\n      this.search();\n    },\n    onSelectChange: function onSelectChange(selection) {\n      this.selection = selection;\n    },\n    search: function search() {\n      this.fetch((0, _objectSpread2.default)({}, this.queryParams, {}, this.sort));\n    },\n    reset: function reset() {\n      this.queryParams = {};\n      this.sort = {};\n      this.$refs.table.clearSort();\n      this.$refs.table.clearFilter();\n      this.search();\n    },\n    singleDownload: function singleDownload(row) {\n      this.$refs.table.toggleRowSelection(row, true);\n      this.batchDownload();\n    },\n    singleDelete: function singleDelete(row) {\n      this.$refs.table.toggleRowSelection(row, true);\n      this.batchDelete();\n    },\n    batchDownload: function batchDownload() {\n      var _this = this;\n\n      if (!this.selection.length) {\n        this.$message({\n          message: this.$t('tips.noDataSelected'),\n          type: 'warning'\n        });\n        return;\n      }\n\n      this.$confirm('确认下载吗？', this.$t('common.tips'), {\n        confirmButtonText: this.$t('common.confirm'),\n        cancelButtonText: this.$t('common.cancel'),\n        type: 'warning'\n      }).then(function () {\n        var ids = [];\n\n        _this.selection.forEach(function (u) {\n          ids.push(u.id);\n        });\n\n        _this.download(ids);\n      }).catch(function () {\n        _this.clearSelections();\n      });\n    },\n    batchDelete: function batchDelete() {\n      var _this2 = this;\n\n      if (!this.selection.length) {\n        this.$message({\n          message: this.$t('tips.noDataSelected'),\n          type: 'warning'\n        });\n        return;\n      }\n\n      this.$confirm(this.$t('tips.confirmDelete'), this.$t('common.tips'), {\n        confirmButtonText: this.$t('common.confirm'),\n        cancelButtonText: this.$t('common.cancel'),\n        type: 'warning'\n      }).then(function () {\n        var ids = [];\n\n        _this2.selection.forEach(function (u) {\n          ids.push(u.id);\n        });\n\n        _this2.delete(ids);\n      }).catch(function () {\n        _this2.clearSelections();\n      });\n    },\n    clearSelections: function clearSelections() {\n      this.$refs.table.clearSelection();\n    },\n    download: function download(ids) {\n      var _this3 = this;\n\n      _Attachment.default.download({\n        ids: ids\n      }).then(function (response) {\n        var res = response.data;\n        var type = res.type;\n\n        if (type.includes('application/json')) {\n          var reader = new FileReader();\n\n          reader.onload = function (e) {\n            if (e.target.readyState === 2) {\n              var data = JSON.parse(e.target.result);\n\n              _this3.$message({\n                message: data.msg,\n                type: 'warning'\n              });\n            }\n          };\n\n          reader.readAsText(res);\n        } else {\n          var disposition = response.headers['content-disposition'];\n          var fileName = '下载文件.zip';\n\n          if (disposition) {\n            var respcds = disposition.split(';');\n\n            for (var i = 0; i < respcds.length; i++) {\n              var header = respcds[i];\n\n              if (header !== null && header !== '') {\n                var headerValue = header.split('=');\n\n                if (headerValue !== null && headerValue.length > 0) {\n                  if (headerValue[0].toLowerCase() === 'filename') {\n                    fileName = decodeURI(headerValue[1]);\n                    break;\n                  }\n                }\n              }\n            }\n          }\n\n          var blob = new Blob([res]);\n          var link = document.createElement('a');\n          link.href = window.URL.createObjectURL(blob);\n          link.download = fileName;\n          link.click();\n          window.URL.revokeObjectURL(link.href);\n        }\n\n        _this3.clearSelections();\n      });\n    },\n    delete: function _delete(ids) {\n      var _this4 = this;\n\n      _Attachment.default.delete({\n        ids: ids\n      }).then(function (response) {\n        var res = response.data;\n\n        if (res.isSuccess) {\n          _this4.$message({\n            message: _this4.$t('tips.deleteSuccess'),\n            type: 'success'\n          });\n        }\n\n        _this4.search();\n      });\n    },\n    onView: function onView(row) {\n      if (row.url) {\n        window.open(_settings.onlinePreview + encodeURIComponent(row.url));\n      }\n    },\n    upload: function upload() {\n      this.dialog.type = 'upload';\n      this.dialog.isVisible = true;\n      this.$refs.edit.setAttachment(false);\n    },\n    edit: function edit(row) {\n      this.$refs.edit.setAttachment(row);\n      this.dialog.type = 'edit';\n      this.dialog.isVisible = true;\n    },\n    fetch: function fetch() {\n      var _this5 = this;\n\n      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.loading = true;\n      params.size = this.pagination.size;\n      params.current = this.pagination.current;\n\n      if (this.queryParams.timeRange) {\n        params.startCreateTime = this.queryParams.timeRange[0];\n        params.endCreateTime = this.queryParams.timeRange[1];\n      }\n\n      _Attachment.default.page(params).then(function (response) {\n        var res = response.data;\n        _this5.loading = false;\n\n        if (res.isSuccess) {\n          _this5.tableData = res.data;\n        }\n      }).catch(function () {\n        _this5.loading = false;\n      });\n    },\n    sortChange: function sortChange(val) {\n      this.sort.field = val.prop;\n      this.sort.order = val.order;\n      this.search();\n    }\n  }\n};\nexports.default = _default;",null]}